---
layout: post
title: Konfigurációs paraméterek EJB és web rétegben Glassfish alkalmazásszerveren
date: '2011-04-18T00:22:00.008+02:00'
author: István Viczián
tags:
- Servlet
- JNDI
- EJB
- Maven
- Java EE
modified_time: '2011-04-18T00:41:13.683+02:00'
thumbnail: http://2.bp.blogspot.com/-6e7EtuGMqJE/TatoRtBeklI/AAAAAAAAGSQ/WFTCrFa_F0A/s72-c/jndi_glassfish_0.png
blogger_id: tag:blogger.com,1999:blog-7370998606556338092.post-2002559707916709456
blogger_orig_url: http://www.jtechlog.hu/2011/04/konfiguracios-parameterek-ejb-es-web.html
---

<p>Utoljára frissítve: 2015. február 3.</p>

<p>Technológiák: Glassfish 4.1, Maven 3.2.1, Java EE 7, EJB 3.1, JNDI</p>

<p>A <a href="/2011/02/27/konfiguracios-parameterek-JBoss.html">Konfigurációs paraméterek EJB és web rétegben JBoss alkalmazásszerveren</a> posztban leírtam, hogyan lehet JBossban konfigurációs paramétereket felvenni, JNDI segítségével. Ebben a posztban leírom, hogy történik mindez Glassfish alatt.</p>

<p>A példaprojekt <a href="https://github.com/vicziani/jtechlog-earconfig">GitHubon megtalálható.</a> Ahhoz, hogy lefordítsuk, adjuk ki az <code>mvn package</code> parancsot a főkönyvtárban. Futtatáshoz az <code>earconfig-ear/target</code> könyvtárban előállt <code>earconfig-ear-1.0-SNAPSHOT.ear</code> fájlt kell a Glassfishre telepítenünk. Persze ezt megoldhatjuk Mavenből is, ehhez először indítsuk el a Glassfisht. Az <code>earconfig-ear/pom.xml</code> fájlban a <code>glassfish</code> profile-ban van definiálva a telepítés, ezért ezzel kell indítani, valamint felül kell definiálnunk jó pár paramétert (host, port, stb.). Ehhez átírhatjuk a <code>pom.xml</code> fájlt, de a <code>-D</code> kapcsolót is használhatjuk a paraméterek felülbírálásához. Tehát adjuk ki a <code>mvn -P glassfish cargo:deploy</code> parancsot az <code>earconfig-ear</code> könyvtárban.</p>

<p>Érdemes megjegyezni, hogy Glasshfish 4.1-ben az adminisztrátori felhasználónév <code>admin</code>, és nincs jelszó megadva. A Cargo nem enged Glassfishre fájl másolásos telepítést, kizárólag az <code>asadmin</code> parancsot hajlandó hívni. Viszont az <code>asadmin</code> parancsnak biztonsági okból már nem lehet paraméterként átadni a jelszót, hanem fájlból olvassa fel. Ezért eltesz egy állományt a temp könyvtárban, nálam Windowson a <code>"C:\Documents and Settings\vicziani\Local Settings\Temp\cargo\conf\password.properties"</code>, Linuxon a <code>/tmp/cargo/conf/password.properties</code> helyen. Volt olyan, hogy hiába frissítettem a jelszót a <code>pom.xml</code>-ben, ez a fájl nem változott, így nem sikerült a telepítés. Megoldásaként csak le kellett törölni ezt az állományt. Még egy trükk. Ha nem állítottuk át a jelszót, hanem üresen hagytuk a Glassfish telepítés után, akkor is meg kell adni a Cargonak az üres stringet, különben nem sikerül a telepítés. A JBoss-sal ellentétben, itt ha az alkalmazást frissíteni akarjuk, nem elegendő a cargo:deploy parancs, hanem a cargo:redeploy parancs kell, mert a Glassfish jelzi, hogy már van alkalmazás telepítve.</p>

<p>Glassfishben a paraméterek, azaz a rendszerparaméterek (system properties) és a JNDI nevek megadása is háromféleképpen történhet: webes adminisztrátori felületen, parancssori adminisztrátori felületen, vagy konfigurációs állományban.</p>

<p>A system property megadása a webes felületen a server menüpontban a Properties/System properties képernyőn lehetséges. Itt menet közben tetszőlegesen is át lehet írni.</p>

<a href="http://2.bp.blogspot.com/-6e7EtuGMqJE/TatoRtBeklI/AAAAAAAAGSQ/WFTCrFa_F0A/s1600/jndi_glassfish_0.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 189px;" src="http://2.bp.blogspot.com/-6e7EtuGMqJE/TatoRtBeklI/AAAAAAAAGSQ/WFTCrFa_F0A/s320/jndi_glassfish_0.png" border="0" alt="Rendszerparaméter beállítása Glassfishen" /></a>

<p><a href="http://download.oracle.com/docs/cd/E18930_01/html/821-2416/ghcjc.html">Parancssorban is</a> fel lehet venni, és listázni.</p>

<pre>
C:\Kaffe\glassfish3\glassfish\bin>asadmin create-system-properties \
 earconfig.system.property="Hello System Property!"
Command create-system-properties executed successfully.

C:\Kaffe\glassfish3\glassfish\bin>asadmin list-system-properties
The target server contains following 1 system properties
earconfig.system.property=Hello System Property!
Command list-system-properties executed successfully.
</pre>

<p>A konfiguráció a <code>\glassfish4\glassfish\domains\domain1\config\domain.xml</code> XML konfigurációs állományba kerül bele.</p>

<p>A JNDI megadása a webes felületen a Resources/JNDI/Custom Resources menüpontban lehetséges. Itt vegyünk fel egy új erőforrást a megfelelő JNDI névvel. Több típus közül is választhatunk. Az értékek megadása un. factory-kkal történik, és a Glassfish tartalmaz pár <a href="http://download.oracle.com/docs/cd/E19798-01/821-1752/giyvw/index.html">előre gyártott factory-t</a>: <code>JavaBeanFactory</code>, <code>PropertiesFactory</code>, <code>PrimitiviesAndStringFactory</code>, <code>URLFactory</code>. Amennyiben <code>String</code>-et akarunk felvenni, típusnál a <code>java.lang.String</code>-et kell kiválasztani, a Factory Class ilyenkor <code>org.glassfish.resources.custom.factory.PrimitivesAndStringFactory</code> lesz, és fel kell venni egy property-t <code>value</code> névvel. Legyen az értéke a <code>Hello JNDI!</code>.</p>

<a href="http://4.bp.blogspot.com/-XY1WEM1doEM/TatoVkooENI/AAAAAAAAGSY/q21lhPVBunY/s1600/jndi_glassfish_1.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 206px;" src="http://4.bp.blogspot.com/-XY1WEM1doEM/TatoVkooENI/AAAAAAAAGSY/q21lhPVBunY/s320/jndi_glassfish_1.png" border="0" alt="JNDI megadása Glassfishen" /></a>

<p>URL esetén hasonló a helyzet, de a Resource Type <code>java.net.URL</code> és a factory <code>org.glassfish.resources.custom.factory.URLObjectFactory</code>. Itt property-nek a <code>spec</code>-t kell megadni, érték legyen pl. <code>http://www.jtechlog.hu</code>. Properties megadása már érdekesebb. Itt is a Resource Type-nál ki kell választani a <code>java.util.Properties</code>-t (, a factory <code>org.glassfish.resources.custom.factory.PropertiesFactory</code> lesz). Itt a propertiesnél megadhatjuk a név és érték párokat is. Amennyiben egy speciálisat adunk meg <code>org.glassfish.resources.custom.factory.PropertiesFactory.fileName</code> néven, az értéknél szereplő properties fájlt fogja betölteni (, szemben a dokumentációval, ami csak fileName-t ír). A fájlnév lehet abszolút, vagy a Glassfish telepítési könyvtárához képest relatív. A properties állományt szerkesztéskor szépen újra is olvassa. Amennyiben a fájlban és a felületen is megadtunk kulcs-érték párokat, a Glassfish összefésüli ezeket. A JBossban definiálható <code>InetAddress</code> típushoz itt nem találtam factory-t.</p>

<p>A JNDI bejegyzések ugyanúgy <a href="http://download.oracle.com/docs/cd/E18930_01/html/821-2416/gglpq.html">parancssorból is konfigurálhatóak</a>. A Glassfish egy régebbi verziójában volt webes JNDI browser felület. Ez most egyelőre csak parancssorból elérhető.</p>

<pre>
$ asadmin create-custom-resource \
	--restype java.lang.String \
	--factoryclass org.glassfish.resources.custom.factory.PrimitivesAndStringFactory \
	--property value="Hello JNDI!" earconfig/string
Custom Resource earconfig/string created.
Command create-custom-resource executed successfully.

$ asadmin list-custom-resources
earconfig/url
earconfig/properties
earconfig/string
Command list-custom-resources executed successfully.
</pre>

<p>Az értékek ugyanúgy a <code>\glassfish4\glassfish\domains\domain1\config\domain.xml</code> XML konfigurációs állományba kerülnek. Akár saját factory osztályokat is használhatunk.</p>

<p>Ezeket elvégezve az alkalmazás a http://localhost:8080/earconfig/ címen érhető el, és a következőt kell kiírnia:</p>

<pre>
A projekt bemutatja, hogy hogyan lehet Java EE alkalmazásból konfigurációs paramétereket 
beolvasni.

    * System property EJB rétegben (kulcs: earconfig.system.property): Hello \
System Property!
    * Context lookup (JNDI) EJB rétegben (JNDI nevek: earconfig/string, \
 earconfig/url, earconfig/inetaddress, earconfig/properties): [Hello JNDI!, \
http://jtechlog.blogspot.com, null, {key=value, key2=value2, key1=value1}]
    * System property web rétegben (kulcs: earconfig.system.property): Hello System Property!
    * Context lookup (JNDI) web rétegben (JNDI nevek: earconfig/string, \
 earconfig/url, earconfig/inetaddress, earconfig/properties): [Hello JNDI!, \
http://www.jtechlog.hu, null, {key=value, key2=value2, key1=value1}]
</pre>
